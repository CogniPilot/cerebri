# ESC Passthrough Configuration
#
# Implements the 4-way interface protocol for programming ESCs
# using BLHeli Suite, BLHeli Configurator, ESC Configurator, etc.
#
# Ports:
#   USB-C (CDC ACM /dev/ttyACM0) - ESC passthrough for BLHeli tools
#   lpuart0 (debug cable /dev/ttyUSB0) - Console/shell for debugging

# App name
CONFIG_CEREBRI_APP_NAME="esc_passthrough"

# System clock - higher tick rate for tickless kernel efficiency
CONFIG_SYS_CLOCK_TICKS_PER_SEC=10000

# USB Device Stack (new stack - no deprecation warnings)
CONFIG_USB_DEVICE_STACK_NEXT=y
CONFIG_USBD_CDC_ACM_CLASS=y

# CDC ACM serial backend initialization
CONFIG_CDC_ACM_SERIAL_INITIALIZE_AT_BOOT=y
CONFIG_CDC_ACM_SERIAL_ENABLE_AT_BOOT=y
CONFIG_CDC_ACM_SERIAL_PRODUCT_STRING="ESC Passthrough"
# STMicroelectronics VID (0x0483) - matches Betaflight flight controllers
CONFIG_CDC_ACM_SERIAL_VID=0x0483
CONFIG_CDC_ACM_SERIAL_PID=0x5740

# Serial (UART) for console on lpuart0
CONFIG_SERIAL=y
CONFIG_UART_INTERRUPT_DRIVEN=y
# Note: LINE_CTRL can cause TX drops if DTR not set by host (WebSerial issue)
# CONFIG_UART_LINE_CTRL=y

# Console on lpuart0 (debug cable)
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y

# Shell on lpuart0 for debugging
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_SERIAL=y

# FlexIO UART driver for ESC single-wire communication
CONFIG_NXP_FLEXIO_UART=y
CONFIG_CLOCK_CONTROL=y
CONFIG_PINCTRL=y

# GPIO still needed for shell test commands
CONFIG_GPIO=y

# Logging to console
CONFIG_LOG=y
CONFIG_LOG_MODE_DEFERRED=y
CONFIG_LOG_BACKEND_UART=y
CONFIG_LOG_BUFFER_SIZE=8192
CONFIG_LOG_PROCESS_TRIGGER_THRESHOLD=0

# Reduce USB logging verbosity (very noisy at boot otherwise)
CONFIG_USBD_LOG_LEVEL_WRN=y
CONFIG_USBD_CDC_ACM_LOG_LEVEL_WRN=y
CONFIG_UDC_DRIVER_LOG_LEVEL_WRN=y

# General
CONFIG_MAIN_THREAD_PRIORITY=5
CONFIG_MAIN_STACK_SIZE=4096

# Minimal libc
CONFIG_NEWLIB_LIBC=y

# Enable floating-point printf
CONFIG_CBPRINTF_FP_SUPPORT=y
